<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../paper-input/paper-input.html"><link rel="import" href="../iron-jsonp-library/iron-jsonp-library.html"><link rel="import" href="../iron-icon/iron-icon.html"><link rel="import" href="paper-input-place-icons.html"></head><body><dom-module id="paper-input-place"><template><style>:host{display:block;}iron-icon{@apply --paper-input-place-icon-mixin;}#prefixicon{@apply --paper-input-place-prefix-icon-mixin;}#postfixicon{@apply --paper-input-place-postfix-icon-mixin;}iron-icon[hidden]{display:none !important;}</style><template is="dom-if" if="[[apiKey]]" restamp="true"><iron-jsonp-library library-url="[[_gmapApiUrl]]" notify-event="map-api-load" library-loaded="{{_ijplLoaded}}" on-map-api-load="_mapsApiLoaded"></iron-jsonp-library></template><paper-input id="locationsearch" label="[[label]]" value="{{_value}}" invalid="[[invalid]]" disabled$="[[disabled]]" error-message="[[errorMessage]]"><iron-icon id="prefixicon" hidden$="[[hideIcon]]" icon="papinpplc:place" slot="prefix"></iron-icon><iron-icon id="postfixicon" icon="papinpplc:clear" slot="suffix" on-tap="_clearLocation"></iron-icon></paper-input></template><script>Polymer({is:"paper-input-place",properties:{apiKey:{type:String,notify:!0},apiLoaded:{type:Boolean,notify:!0,value:!1,readOnly:!0},hideError:{type:Boolean,value:!1},hideIcon:{type:Boolean,value:!1},disabled:{type:Boolean,notify:!0,value:!1},_geocoder:{type:Object},searchCountryCode:{type:String,value:""},searchBounds:{type:Object},searchType:{type:String,value:""},errorMessage:{type:String,value:"Invalid - please select a place",notify:!0},invalid:{type:Boolean,notify:!0,readOnly:!0,value:!1},_invalid:{type:Boolean,value:!1},label:{type:String,notify:!0,value:""},latLng:{type:Object,notify:!0,readOnly:!0,value:function(){return{lat:0,lng:0}}},place:{type:Object,notify:!0,readOnly:!0,value:function(){return{}}},_places:{type:Object},required:{type:Boolean,notify:!0,value:!1},value:{type:Object,notify:!0,observer:"_valueChanged"},_value:{type:String,notify:!0,value:"",observer:"_svalChanged"},_gmapApiUrl:{type:String,notify:!0,computed:"_computeUrl(apiKey)"},_ijplLoaded:{type:Boolean}},observers:["_searchBiasChanged(searchCountryCode,searchBounds,searchBoundsStrict,searchType)"],ready:function(){var a=this.$$("google-maps-api");a&&a.libraryLoaded&&this._mapsApiLoaded()},_computeUrl:function(a){return"https://maps.googleapis.com/maps/api/js?callback=%%callback%%&v=3.exp&libraries=drawing,geometry,places,visualization&key="+a},_mapsApiLoaded:function(){!this._geocoder&&!this._places&&this.$.locationsearch&&this.$.locationsearch.$.nativeInput&&(this._geocoder=new google.maps.Geocoder,this._places=new google.maps.places.Autocomplete(this.$$("#locationsearch").$$("#nativeInput"),{}),google.maps.event.addListener(this._places,"place_changed",this._onChangePlace.bind(this)),this._setApiLoaded(!0),this._searchBiasChanged(),this.fire("api-loaded",{text:"Google api is ready"}))},_searchBiasChanged:function(){this.apiLoaded&&(this.searchBounds&&this.searchBounds.hasOwnProperty("east")&&this.searchBounds.hasOwnProperty("west")&&this.searchBounds.hasOwnProperty("north")&&this.searchBounds.hasOwnProperty("south")?this._places.setBounds(this.searchBounds):this._places.setBounds(),this.searchCountryCode&&2==this.searchCountryCode.length?this._places.setComponentRestrictions({country:this.searchCountryCode.toString()}):this._places.setComponentRestrictions(),this.searchType&&["address","geocode","establishment","(regions)","(cities)"].includes(this.searchType)?this._places.setTypes([this.searchType.toString()]):this._places.setTypes([]))},_valueChanged:function(a,b){b&&a.search===b.search&&a.search===this._value||(this._value=a&&a.search?a.search:"",this._invalid=!a||!(a.place_id&&a.latLng&&a.latLng.lat&&a.latLng.lng),!this.hideError&&this._setInvalid(this.required?this._invalid:this._invalid&&a&&a.search))},_svalChanged:function(a){return a&&this.place&&this.place.search&&a==this.place.search?(this.value={place_id:this.place.place_id,search:a,latLng:{lat:this.place.latLng.lat,lng:this.place.latLng.lng}},this._invalid=!1,void this._setInvalid(!1)):a||this.required?a&&this.value&&this.value.search&&a==this.value.search?void 0:this.value&&this.value.search||!a?(this.value={place_id:"",search:a,latLng:{lat:0,lng:0}},this._setPlace({}),this._invalid=!0,void(this.hideError||this._setInvalid(!0))):(this.value={place_id:"",search:a,latLng:{lat:0,lng:0}},this._setPlace({}),this._invalid=!0,void(this.hideError||this._setInvalid(!0))):(this.value={place_id:"",search:"",latLng:{lat:0,lng:0}},this._setPlace({}),this._invalid=!0,void(this.hideError||this._setInvalid(!1)))},_clearLocation:function(){this._value=""},geocode:function(a,b){return new Promise(function(c,d){if(!this._geocoder)d("Geocoder not ready.");else{var e=b?b:{};e.address=a?a:"",this._geocoder.geocode(e,function(a,b){if(b==google.maps.GeocoderStatus.OK&&a&&a[0]){var f=this._extractPlaceInfo(a[0],e.address);c(f)}else d(b)}.bind(this))}}.bind(this))},reverseGeocode:function(a,b){return new Promise(function(c,d){if(!this._geocoder)d("Geocoder not ready.");else{var e=b?b:{};a&&(e.location=a),this._geocoder.geocode(e,function(a,b){if(b==google.maps.GeocoderStatus.OK&&a&&a[0]){var e=this._extractPlaceInfo(a[0],"");c(e)}else d(b)}.bind(this))}}.bind(this))},_onChangePlace:function(){var a=this._places.getPlace();if(a.geometry){var b=this._extractPlaceInfo(a,this.$.locationsearch.$.nativeInput.value);this._setPlace(b),this._invalid=!1,this._setInvalid(!1),this._setLatLng({lat:b.latLng.lat,lng:b.latLng.lng}),this._value=this.$.locationsearch.$.nativeInput.value,this.value={search:this.$.locationsearch.$.nativeInput.value,place_id:b.place_id,latLng:{lat:b.latLng.lat,lng:b.latLng.lng}}}},_extractPlaceInfo:function(a,b){for(var c={place_id:a.place_id,formatted_address:a.formatted_address,search:b?b:a.formatted_address,latLng:{lat:a.geometry.location.lat(),lng:a.geometry.location.lng()},basic:{name:a.name||"",address:"",city:"",state:"",stateCode:"",postalCode:"",country:"",countryCode:"",phone:a.formatted_phone_number||""},placeDetails:{address_components:[],icon:a.icon,international_phone_number:a.international_phone_number||"",permanently_closed:a.permanently_closed||!1,types:a.types?JSON.parse(JSON.stringify(a.types)):[],website:a.website||"",url:a.url||"",utc_offset:a.utc_offset}},d={street_number:"",route:""},e=0;e<a.address_components.length;e++)switch(c.placeDetails.address_components.push(JSON.parse(JSON.stringify(a.address_components[e]))),a.address_components[e].types[0]){case"locality":c.basic.city=a.address_components[e].long_name;break;case"administrative_area_level_1":c.basic.stateCode=a.address_components[e].short_name,c.basic.state=a.address_components[e].long_name;break;case"country":c.basic.country=a.address_components[e].long_name,c.basic.countryCode=a.address_components[e].short_name;break;case"postal_code":c.basic.postalCode=a.address_components[e].long_name;break;case"street_number":d.street_number=a.address_components[e].short_name,c.basic.address=d.street_number+" "+d.route;break;case"route":d.route=a.address_components[e].long_name,c.basic.address=d.street_number+" "+d.route;break;default:d[a.address_components[e].types[0]]=a.address_components[e].long_name;}return c},putPlace:function(a){a&&a.place_id&&a.latLng&&(this._setPlace(JSON.parse(JSON.stringify(a))),this._setLatLng({lat:a.latLng.lat,lng:a.latLng.lng}),this.value={place_id:a.place_id,search:a.search,latLng:{lat:a.latLng.lat,lng:a.latLng.lng}},this._value=a.search)},focus:function(){this.$$("#locationsearch").$.nativeInput.focus()}});</script></dom-module></body></html>